{% extends 'base.html' %}
{% load crispy_forms_tags %}

{% block content %}
<div class="card">
    <div class="card-header bg-warning text-white">
        <h3>Step 3: Add Table Data</h3>
    </div>
    <div class="card-body">
        <form method="post">
        <input type="hidden" name="table_id" value="{{ tableId }}">
        <input type="hidden" name="quotation_id" value="{{ quotationId }}">
        <input type="hidden" name="field_id" value="{{ fieldId }}">
        <input type="hidden" name="row_id" value="{{ tableRowId }}">
            {% csrf_token %}
             {{ forms|crispy }}
                        {% for hidden_field in forms.hidden_fields %}
                            {% if hidden_field.errors %}
                                <ul>
                                {% for error in hidden_field.errors %}
                                    <li>(Hidden field {{ hidden_field.name }}) {{ error }}</li>
                                {% endfor %}
                                </ul>
                            {% endif %}
                            {{ hidden_field }}
                            {% endfor %}
            <button type="submit" class="btn btn-warning">Submit</button>
        </form>
       <hr>
        <h4>Table Headers</h4>
        <table id="tblHeaders" class="table table-striped table-bordered width-full isoViewTbl">
    <thead>
        <tr>
            <th class="all">S.no</th>
            {% for tableHeader in tableHeaders %}
                <th class="all">{{ tableHeader.field_name }}</th>
            {% endfor %}
            <th class="all text-center statusTd">Action</th>
        </tr>
    </thead>
    <tbody>
        {% regroup tableValues by row_id as row_list %}
        
        {% for row in row_list %}
            <tr class="{% cycle 'odd' 'even' %}" id="row_{{ row.grouper }}">
                <td>{{ forloop.counter }}</td>
                
                {% for header in tableHeaders %}
                    <td>
                        {% for value in row.list %}
                            {% if value.field_id == header.id %}
                                {{ value.field_value }}
                            {% endif %}
                        {% endfor %}
                    </td>
                {% endfor %}
                
                <td class="text-nowrap text-center">
                    <span>
                        <a href="{% url 'add_table_value' %}?customer_id={{ request.session.customer_id }}&quotation_id={{ quotationId }}&table_id={{ tableId }}&row_id={{ row.grouper }}" title="Edit">
                            <span><i class="fa fa-edit text-blue fa-lg"></i></span>
                        </a>
                    </span>
                </td>
            </tr>
        {% empty %}
            <tr>
                <td colspan="{{ tableHeaders|length|add:2 }}" class="text-center">No records found</td>
            </tr>
        {% endfor %}
    </tbody>
</table> 
<hr>
<span class="ms-2">
            <a class="btn btn-info" href="{% url 'add_complaint_details' %}?customer_id={{ request.session.customer_id }}&quotation_id={{quotationId}}" title="Add">
                Next â†’ Add Quotation Details
            </a>
        </span>
    </div>
</div>
<script>
    $(document).ready(function() {
        $('.isoDynamicName').attr('name', 'DynamicValues');
        $('.isoHiddenDynamicName').attr('name', 'DynamicHiddenIds');
    }); 
</script>
{% endblock %}